$(function () {
    var options = { path: '/', expires: 10 }; function openPopUp() { $.fancybox.open({ href: '/cart/', autoSize: false, autoDimensions: false, fitToView: false, type: 'iframe', height: '715px', width: '906px', padding: 5, beforeClose: function () { location.reload(); } }); } var count_product = 0; var tables = new Array(); var cookie = unserialize($.cookie("trash_user")); if ($(cookie).length > 0) { $.each(unserialize($.cookie("trash_user")), function (n, val) { tables[n] = val; count_product = count_product + val; }); } $(".count_trash").text(count_product); $(".count_mobile").text('(' + count_product + ')'); $(document).on("click", '.add-to-cart', function () { var attr = $(this).attr("id"); if (typeof (tables[attr]) != 'undefined') { tables[attr]++; } else { tables[attr] = 1; } $.cookie("trash_user", serialize(tables), options); count_product++; $(".count_trash").text(count_product); $(".count_mobile").text('(' + count_product + ')'); $(".modal-add-product").empty(); var item_product = ""; $.post("/index.php?p1=/cart/", { func: "getProduct", prod_id: attr }, function (data) { if (data.result.result == '1') { $('.basket-list').empty(); $.each(data.result.data, function (index, value) { $('.basket-list').prepend('<li class="basket-item">' + '<a class="basket-item-delete" >' + '<span class="fa fa-trash-o product_delete" id="' + value.id + '" aria-hidden="true"></span>' + '</a>' + '<img class="basket-item-image" src="' + value.photo + '"/>' + '<a class="basket-item-link" href="' + value.url + '">' + value.name + '</a>' + '<span class="basket-item-price">' + '<span class="mark_accent-color">Цена:</span>' + value.price + ' грн.   х ' + value.count + '</span>' + '<div class="basket__link"  style="cursor:pointer;">' + '<span class="icon-minus product_minus" id="' + value.id + '"></span>' + '</div>' + '<div class="basket__link" style="cursor:pointer;">' + '<span class="icon-plus product_plus" id="' + value.id + '"></span>' + '</div>' + '</li>'); item_product += '<div class="item_prod">' + '<span class="modal__photo"><img class="photo" src="' + value.photo + '"/></span>' + '<span class="modal__description">' + value.name + '</span>' + '<a class="modal__item-delete" >' + '<span class="fa fa-trash-o product_delete" id="' + value.id + '" aria-hidden="true"></span>' + '</a>' + '<div class="modal__count count">' + '<p class="count__text"><span class="mark_accent-color">Цена:</span>' + value.price + ' грн. х ' + value.count + '</p>' + '</div>' + '</div>'; }); $('.basket-list').append('<li class="basket-item">' + '<span class="basket-item-total-text">Итого:</span>' + '<span class="basket-item-total">' + data.result.total + ' грн.</span>' + '</li><a class="submit" href="/order/">Оформить заказ</a>'); $(".modal-add-product").replaceWith('<div class="modal-add-product">' + '<input class="modal-state-add-product" id="modal-add-product" type="checkbox"/>' + '<div class="modal-fade-screen">' + '<div class="modal-inner">' + '<div class="modal-close js-modal-close"></div>' + '<p class="modal__heading">Вы добавили в корзину</p>' + item_product + '<div class="modal__total total"><span class="total__text">Итого:</span>' + '<span class="total__count">' + '<span class="mark_accent-color">' + data.result.total + '</span>грн.</span>' + '</div>' + '<div class="modal__buttons buttons">' + '<a class="buttons__link buttons__link_left close_modal_prod" style="cursor:pointer;" >Продолжить покупки</a>' + '<a class="buttons__link buttons__link_right" href="/order/">Оформить заказ</a>' + '</div>' + '</div>' + '</div>' + '</div>'); $('.modal-state-add-product').prop('checked', true).change(); } }, "json"); return false; }); function getPriceCart() { $.getJSON("/index.php?method=Ajax&action=getMoney", function (data) { $(".all_amount").html(data); }); } $(document).on("click", '.product_plus', function () { if (typeof (tables[$(this).attr("id")]) != 'undefined') { tables[$(this).attr("id")]++; } else { tables[$(this).attr("id")] = 1; } $("#count" + $(this).attr("id")).val(tables[$(this).attr("id")]); $.cookie("trash_user", serialize(tables), options); count_product++; $("#count_product").text(count_product); var item_product = ""; $.post("/index.php?p1=/cart/", { func: "getProduct" }, function (data) { if (data.result.result == '1') { $('.basket-list').empty(); $.each(data.result.data, function (index, value) { $('.basket-list').prepend('<li class="basket-item">' + '<a class="basket-item-delete" >' + '<span class="fa fa-trash-o product_delete" id="' + value.id + '" aria-hidden="true"></span>' + '</a>' + '<img class="basket-item-image" src="' + value.photo + '"/>' + '<a class="basket-item-link" href="' + value.url + '">' + value.name + '</a>' + '<span class="basket-item-price">' + '<span class="mark_accent-color">Цена:</span>' + value.price + ' грн.   х ' + value.count + '</span>' + '<div class="basket__link"  style="cursor:pointer;">' + '<span class="icon-minus product_minus" id="' + value.id + '"></span>' + '</div>' + '<div class="basket__link" style="cursor:pointer;">' + '<span class="icon-plus product_plus" id="' + value.id + '"></span>' + '</div>' + '</li>'); item_product += '<div class="item_prod">' + '<span class="modal__photo"><img class="photo" src="' + value.photo + '"/></span>' + '<span class="modal__description">' + value.name + '</span>' + '<a class="modal__item-delete" >' + '<span class="fa fa-trash-o product_delete" id="' + value.id + '" aria-hidden="true"></span>' + '</a>' + '<div class="modal__count count">' + '<p class="count__text"><span class="mark_accent-color">Цена:</span>' + value.price + ' грн. х ' + value.count + '</p>' + '<div class="count__link">' + '</div>' + '<div class="count__link">' + '</div>' + '</div>' + '</div>'; }); $('.basket-list').append('<li class="basket-item">' + '<span class="basket-item-total-text">Итого:</span>' + '<span class="basket-item-total">' + data.result.total + ' грн.</span>' + '</li><a class="submit" href="/order/">Оформить заказ</a>'); $(".modal-add-product").replaceWith('<div class="modal-add-product">' + '<input class="modal-state-add-product" id="modal-add-product" type="checkbox"/>' + '<div class="modal-fade-screen">' + '<div class="modal-inner">' + '<div class="modal-close js-modal-close"></div>' + '<p class="modal__heading">Вы добавили в корзину</p>' + item_product + '<div class="modal__total total"><span class="total__text">Итого:</span>' + '<span class="total__count">' + '<span class="mark_accent-color">' + data.result.total + '</span>грн.</span>' + '</div>' + '<div class="modal__buttons buttons">' + '<a class="buttons__link buttons__link_left close_modal_prod" style="cursor:pointer;" >Продолжить покупки</a>' + '<a class="buttons__link buttons__link_right" href="/order/">Оформить заказ</a>' + '</div>' + '</div>' + '</div>' + '</div>'); } }, "json"); return false; }); $(document).on("click", '.product_minus', function () { if (typeof (tables[$(this).attr("id")]) != 'undefined') { tables[$(this).attr("id")]--; } else { tables[$(this).attr("id")] = 1; } if (tables[$(this).attr("id")] == 0) { delete tables[$(this).attr("id")]; $("#cart" + $(this).attr("id")).remove(); } var item_product = ""; $("#count" + $(this).attr("id")).val(tables[$(this).attr("id")]); $.cookie("trash_user", serialize(tables), options); count_product--; $("#count_product").text(count_product); $.post("/index.php?p1=/cart/", { func: "getProduct" }, function (data) { if (data.result.result == '1') { $('.basket-list').empty(); $.each(data.result.data, function (index, value) { $('.basket-list').prepend('<li class="basket-item">' + '<a class="basket-item-delete" >' + '<span class="fa fa-trash-o product_delete" id="' + value.id + '" aria-hidden="true"></span>' + '</a>' + '<img class="basket-item-image" src="' + value.photo + '"/>' + '<a class="basket-item-link" href="' + value.url + '">' + value.name + '</a>' + '<span class="basket-item-price">' + '<span class="mark_accent-color">Цена:</span>' + value.price + ' грн.   х ' + value.count + '</span>' + '<div class="basket__link"  style="cursor:pointer;">' + '<span class="icon-minus product_minus" id="' + value.id + '"></span>' + '</div>' + '<div class="basket__link" style="cursor:pointer;">' + '<span class="icon-plus product_plus" id="' + value.id + '"></span>' + '</div>' + '</li>'); item_product += '<div class="item_prod">' + '<span class="modal__photo"><img class="photo" src="' + value.photo + '"/></span>' + '<span class="modal__description">' + value.name + '</span>' + '<a class="modal__item-delete" >' + '<span class="fa fa-trash-o product_delete" id="' + value.id + '" aria-hidden="true"></span>' + '</a>' + '<div class="modal__count count">' + '<p class="count__text"><span class="mark_accent-color">Цена:</span>' + value.price + ' грн. х ' + value.count + '</p>' + '<div class="count__link">' + '</div>' + '<div class="count__link">' + '</div>' + '</div>' + '</div>'; }); $('.basket-list').append('<li class="basket-item">' + '<span class="basket-item-total-text">Итого:</span>' + '<span class="basket-item-total">' + data.result.total + ' грн.</span>' + '</li><a class="submit" href="/order/">Оформить заказ</a>'); $(".modal-add-product").replaceWith('<div class="modal-add-product">' + '<input class="modal-state-add-product" id="modal-add-product" type="checkbox"/>' + '<div class="modal-fade-screen">' + '<div class="modal-inner">' + '<div class="modal-close js-modal-close"></div>' + '<p class="modal__heading">Вы добавили в корзину</p>' + item_product + '<div class="modal__total total"><span class="total__text">Итого:</span>' + '<span class="total__count">' + '<span class="mark_accent-color">' + data.result.total + '</span>грн.</span>' + '</div>' + '<div class="modal__buttons buttons">' + '<a class="buttons__link buttons__link_left close_modal_prod" style="cursor:pointer;" >Продолжить покупки</a>' + '<a class="buttons__link buttons__link_right" href="/order/">Оформить заказ</a>' + '</div>' + '</div>' + '</div>' + '</div>'); } }, "json"); return false; }); $(document).on("click", '.product_delete', function () {
        prod_id = $(this).attr("id").substr(3, 10)
        count_product = count_product - parseInt($("#count" + $(this).attr("id")).val()); 
        
        $("#count_product").text(count_product); 
        
        if (typeof (tables[$(this).attr("id")]) != 'undefined') { 
            delete tables[$(this).attr("id")]; 
            $("#cart" + $(this).attr("id")).remove(); 
        } 
        else { 
            tables[$(this).attr("id")] = 1; 
        } 
        
        $.cookie("trash_user", serialize(tables), options); 
        location.reload(); 
        return false;

    }); $('.submit').on("click", function () { });
});
